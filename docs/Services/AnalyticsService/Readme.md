# AnalyticsService - Ph√¢n t√≠ch d·ªØ li·ªáu & b√°o c√°o

## üìã T·ªïng quan

**Ng√¥n ng·ªØ l·∫≠p tr√¨nh:** Python 3.11 + FastAPI + ClickHouse + Pandas  
**C∆° s·ªü d·ªØ li·ªáu:** ClickHouse (`analytics_db`)  
**Tr·∫°ng th√°i:** üü° ƒêang ph√°t tri·ªÉn

D·ªãch v·ª• Analytics cung c·∫•p kh·∫£ nƒÉng ph√¢n t√≠ch d·ªØ li·ªáu m·∫°nh m·∫Ω, t·∫°o b√°o c√°o chi ti·∫øt v√† dashboard th·ªùi gian th·ª±c cho h·ªá th·ªëng CityResQ360.

---

## üéØ Ch·ª©c nƒÉng ch√≠nh

### üìä Th·ªëng k√™ Dashboard

- **S·ªë li·ªáu th·ªùi gian th·ª±c**

  - T·ªïng s·ªë ph·∫£n √°nh
  - S·ªë s·ª± c·ªë ƒëang x·ª≠ l√Ω
  - Th·ªùi gian ph·∫£n h·ªìi trung b√¨nh
  - T·ª∑ l·ªá ho√†n th√†nh
  - Ng∆∞·ªùi d√πng ho·∫°t ƒë·ªông

- **Theo d√µi KPI**

  - Response time SLA
  - Resolution time SLA
  - Customer satisfaction score
  - Agency performance
  - System uptime

- **Ch·ªâ s·ªë hi·ªáu su·∫•t**

  - Reports per day/week/month
  - Average resolution time
  - First response time
  - Escalation rate
  - Reopen rate

- **Ph√¢n t√≠ch xu h∆∞·ªõng**
  - Time-series trends
  - Seasonal patterns
  - Growth rate
  - Forecasting
  - Anomaly detection

### üìà T·∫°o b√°o c√°o

- **B√°o c√°o ng√†y/tu·∫ßn/th√°ng**

  - Daily summary
  - Weekly digest
  - Monthly report
  - Quarterly review
  - Annual report

- **Ph·∫°m vi ng√†y t√πy ch·ªânh**

  - Custom date range
  - Comparison periods
  - Year-over-year
  - Month-over-month
  - Week-over-week

- **Xu·∫•t ra PDF/Excel**

  - PDF reports v·ªõi charts
  - Excel spreadsheets
  - CSV exports
  - JSON data dumps
  - Scheduled exports

- **L·∫≠p l·ªãch t·ª± ƒë·ªông**
  - Scheduled reports
  - Email delivery
  - Auto-generation
  - Recurring schedules
  - Cron-based triggers

### üîç T·ªïng h·ª£p d·ªØ li·ªáu

- **Ph√¢n t√≠ch ƒëa chi·ªÅu**

  - Multi-dimensional analysis
  - Drill-down capabilities
  - Slice and dice
  - Pivot tables
  - OLAP cubes

- **T·ªïng h·ª£p chu·ªói th·ªùi gian**

  - Time-series aggregation
  - Rolling windows
  - Moving averages
  - Cumulative sums
  - Rate of change

- **Ph√¢n t√≠ch nh√≥m**

  - Group by category
  - Group by location
  - Group by agency
  - Group by status
  - Custom grouping

- **Ph√¢n t√≠ch ph·ªÖu**
  - Conversion funnel
  - Drop-off analysis
  - Stage-by-stage metrics
  - Bottleneck identification
  - Optimization insights

### üéØ Tr√≠ tu·ªá kinh doanh

- **Ph√¢n t√≠ch d·ª± ƒëo√°n**

  - Predictive models
  - Machine learning integration
  - Trend forecasting
  - Risk prediction
  - Resource planning

- **Ph√°t hi·ªán b·∫•t th∆∞·ªùng**

  - Anomaly detection
  - Outlier identification
  - Unusual patterns
  - Alert triggers
  - Root cause analysis

- **Nh·∫≠n d·∫°ng m·∫´u**

  - Pattern recognition
  - Clustering analysis
  - Association rules
  - Sequence mining
  - Behavioral patterns

- **D·ª± b√°o**
  - Time-series forecasting
  - Demand prediction
  - Capacity planning
  - Budget forecasting
  - Scenario analysis

---

## üìä Lo·∫°i b√°o c√°o

### B√°o c√°o v·∫≠n h√†nh

- T·ªïng quan ho·∫°t ƒë·ªông h·ªá th·ªëng
- S·ªë l∆∞·ª£ng ph·∫£n √°nh theo lo·∫°i
- Th·ªùi gian x·ª≠ l√Ω trung b√¨nh
- T·ª∑ l·ªá ho√†n th√†nh ƒë√∫ng h·∫°n
- Top issues v√† hotspots

### B√°o c√°o hi·ªáu su·∫•t c∆° quan

- S·ªë l∆∞·ª£ng s·ª± c·ªë ƒë∆∞·ª£c g√°n
- Th·ªùi gian ph·∫£n h·ªìi
- Th·ªùi gian gi·∫£i quy·∫øt
- T·ª∑ l·ªá ho√†n th√†nh
- ƒê√°nh gi√° t·ª´ ng∆∞·ªùi d√¢n

### B√°o c√°o ng∆∞·ªùi d√πng

- S·ªë l∆∞·ª£ng ng∆∞·ªùi d√πng m·ªõi
- Ng∆∞·ªùi d√πng ho·∫°t ƒë·ªông
- Engagement metrics
- CityPoint earned/redeemed
- User satisfaction

### B√°o c√°o ƒë·ªãa l√Ω

- Ph·∫£n √°nh theo khu v·ª±c
- B·∫£n ƒë·ªì nhi·ªát
- Hotspot analysis
- Coverage analysis
- Regional comparison

---

## üîó T√≠ch h·ª£p

D·ªãch v·ª• n√†y t√≠ch h·ª£p v·ªõi:

- **ClickHouse**: L∆∞u tr·ªØ d·ªØ li·ªáu ph√¢n t√≠ch
- **AnalyticsConsumer**: Nh·∫≠n s·ª± ki·ªán t·ª´ RabbitMQ
- **CoreAPI**: Cung c·∫•p d·ªØ li·ªáu cho dashboard
- **IncidentService**: Ph√¢n t√≠ch d·ªØ li·ªáu s·ª± c·ªë
- **IoTService**: Ph√¢n t√≠ch d·ªØ li·ªáu c·∫£m bi·∫øn
- **NotificationService**: G·ª≠i b√°o c√°o ƒë·ªãnh k·ª≥

---

## üìä C·∫•u tr√∫c d·ªØ li·ªáu ClickHouse

### B·∫£ng Events

```sql
CREATE TABLE events (
    event_id UUID,
    event_type String,
    timestamp DateTime,
    user_id UInt64,
    entity_id UInt64,
    entity_type String,
    metadata String,
    created_at DateTime DEFAULT now()
) ENGINE = MergeTree()
ORDER BY (timestamp, event_type);
```

### T·ªïng h·ª£p b√°o c√°o

```sql
CREATE MATERIALIZED VIEW reports_daily AS
SELECT
    toDate(created_at) as date,
    category,
    status,
    count() as total_reports,
    avg(resolution_time) as avg_resolution_time
FROM reports
GROUP BY date, category, status;
```

---

## üìÑ Gi·∫•y ph√©p

D·ª± √°n n√†y ƒë∆∞·ª£c ph√¢n ph·ªëi d∆∞·ªõi [GNU General Public License v3.0](https://github.com/MNM-DTU-DZ/CityResQ360-DTUDZ/blob/master/LICENSE).
